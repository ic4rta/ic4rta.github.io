<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Explotanto un PRNG bad seed &#8211; c4rta</title> <meta name="description" content="Soy Omar, un amante de la ciberseguridad y las radiocomunicaciones"> <meta name="keywords" content="Explotacion Binaria, bad seed"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo7.jpg"> <meta name="twitter:title" content="Explotanto un PRNG bad seed"> <meta name="twitter:description" content="Te mostrare como puedes abusar de la generacion de numeros aleatorios generados por la funcion rand() con el fin de predecir un numero"> <meta name="twitter:site" content="@_c4rta_"> <meta name="twitter:creator" content="@_c4rta_"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Explotanto un PRNG bad seed"> <meta property="og:description" content="Te mostrare como puedes abusar de la generacion de numeros aleatorios generados por la funcion rand() con el fin de predecir un numero"> <meta property="og:url" content="http://localhost:4000/prng-bad-seeds/"> <meta property="og:site_name" content="c4rta"> <meta property="og:image" content="http://localhost:4000/assets/img/logo7.jpg"> <link rel="canonical" href="http://localhost:4000/prng-bad-seeds/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="c4rta Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo7.jpg" alt="c4rta photo" class="author-photo"> <h4>c4rta</h4> <p>Soy Omar, un amante de la ciberseguridad y las radiocomunicaciones</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://twitter.com/_c4rta_" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://github.com/ic4rta" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Explotanto un PRNG bad seed</h1> <h4>20 Dec 2022</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~4 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p class="lead">Te mostrare como puedes abusar de la generacion de numeros aleatorios generados por la funcion rand() con el fin de predecir un numero</p> <h2 id="que-es-una-seed">¿Que es una seed?</h2> <p>Las “seed” o semilla en español, es un numerito inicial del generador de numeros pseudoaleatorios (PRNG), la cual es completamente determinista, es decir, que la generacion de numeros aleatorios esta determinada por la semilla y eso hace que el generador produzca la misma secuencia de numeros para un valor dado.</p> <p>Esto va mas alla de hacer un simple programa en C que genere numeros random, las semillas se usan mucho en la ciberseguridad y mas que nada en la criptografia, es importante generar una buena semilla ya que si se obtiene el valor de la semilla se puede romper por completo el proceso de cifrado, parece una tonteria que con conocer un numerito se ocasiona un problema muy grave, si quieres ver ejemplos reales de una vulnerabilidad como esta puedes buscar</p> <ul> <li> <p>CVE-2020-7010: La aplicación en la nube en Kubernetes genera contraseñas mediante un generador de números aleatorios débil en función del tiempo de implementación.</p> </li> <li> <p>CVE-2019-11495: El servidor usa erlang:now() para sembrar el PRNG, lo que da como resultado un pequeño espacio de búsqueda para posibles semillas aleatorias</p> </li> <li> <p>CVE-2018-12520: El PRNG del producto no está sembrado para la generación de ID de sesión</p> </li> <li> <p>CVE-2016-10180: La generación de PIN del enrutador se basa en la siembra de rand (time(0)).</p> </li> </ul> <p>Referencia por <a href="https://cwe.mitre.org/data/definitions/335.html">MITRE</a></p> <h2 id="que-es-prng">¿Que es PRNG?</h2> <p>La generacion de numeros pseudoaleatorios (PRNG) es una funcion que genera numeros aleatorios dado tres estados, pongamolos que PRNG actua como una caja negra, que toma un numero (semilla) y produce una secuencia de bits, segun, se dice que esta secuencia es random si pasa una serie de pruebas estadisticas, y entonces se dice que es random, las pruebas puede ser que se mide la frecuencia de bits y secuencia de bits.</p> <p>Dije que esta dado tres estados, estos son:</p> <ul> <li><strong>Estado de inicializacion</strong>: El cual toma la semilla y pone al generador en su estado inicial</li> <li><strong>Estado de transicion</strong>: Transforma el estado del generador tomando en cuenta la semilla</li> <li><strong>Estado de salida</strong>: Transforma el estado actual para producir un numero fijo de bits</li> </ul> <p>Para que quede mas claro veamos lo siguiente:</p> <p>Se obtiene una secuencia de bits pseudoaleatoria el cual es puesta en el generador usando la semilla (primer estado), y poniendo al generador a llamar a la funcion de transicion repetidamente (segundo estado) y por ultimo se produce una salida de bits aleatorios (tercer estado)</p> <p><img src="/assets/img/prng/prng.png" alt="" /></p> <h2 id="explotando-un-prng-bad-seed">Explotando un PRNG bad seed</h2> <p>Usare el ejemplo mas simple que pude encontrar, es de la pagina pwnable.kr y el problema se llama “random”, te puedes contectar usando SSH <code class="language-plaintext highlighter-rouge">ssh random@pwnable.kr -p2222</code> pw:guest</p> <p>Este es el codigo del archivo ejecutable:</p> <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(){</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">random</span><span class="p">;</span>
	<span class="n">random</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>	<span class="c1">// valor random
</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">key</span> <span class="o">^</span> <span class="n">random</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xdeadbeef</span> <span class="p">){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Good!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="n">system</span><span class="p">(</span><span class="s">"/bin/cat flag"</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">"Wrong, maybe you should try 2^32 cases.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div> <p>Y como extra la pista que nos dejan es: <code class="language-plaintext highlighter-rouge">¡Papi, enséñame a usar valores aleatorios en la programación!</code></p> <p>El programa es muy simple acepta la entrada de números enteros y lo compara con 0xdeadbeef y, si el valor coincide, debe mostrar la flag</p> <p>El programa usa la función rand() para generar un valor aleatorio. La función rand() devuelve un número pseudoaleatorio, rand es inseguro para generar números aleatorios. Los números que genera son predecibles cuando la semilla no es dada para el rand. Entonces si la semilla se establece en 1, el generador se reinicializa a su valor inicial y produce los mismos valores</p> <h3 id="que-significa-key--random">¿Que significa “key ^ random”?</h3> <p>Esta es la pieza clave del programa, el símbolo ^ es el operador XOR en C. XOR es el equivalente a “o”, que significa “uno o el otro, pero no ambos”, con esto que tenemos hasta ahora se puede podemos generar una ecuacion que es <code class="language-plaintext highlighter-rouge">random ^ 0xdeadbeef = key</code>, esta ecuacion nos permite resolver <code class="language-plaintext highlighter-rouge">key</code></p> <h3 id="entonces-que-debemos-de-hacer">¿Entonces que debemos de hacer?</h3> <p>Para poder resolverlo debemos de hacer de que <code class="language-plaintext highlighter-rouge">key ^ random</code> sea igual a <code class="language-plaintext highlighter-rouge">0xdeadbeef</code> y para eso debemos de encontrar la manera de predecir el valor generado de la funcion rand() y luego revertir la operacion haciendo XORing el valor de rand() con 0xdeadbeef. Que genial, ¿No? ^-^</p> <h2 id="explotando-el-binario">Explotando el binario</h2> <p>Como primer paso generaremos un numero aleatorio con rand en otro programa</p> <div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">rand</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div> <p>Una vez ejecutandolo nos dara este numero <code class="language-plaintext highlighter-rouge">1804289383</code> y nuestra ecuacion queda asi <code class="language-plaintext highlighter-rouge">1804289383 ^ 0xdeadbeef = key</code></p> <p>Como segundo paso vamos hacer XORing con <code class="language-plaintext highlighter-rouge">0xdeadbeef</code></p> <p>Yo lo hare abriendo el interprete de python e ingresare <code class="language-plaintext highlighter-rouge">1804289383 ^ 0xdeadbeef</code>, esto nos dara algo como esto <code class="language-plaintext highlighter-rouge">3039230856</code>, y ese valor es el numero que le pasaremos al programa</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">random@pwnable:~$ </span>./random 
3039230856
Good!
Mommy, I thought libc random is unpredictable...
</code></pre></div> <p>Y listo, hemos resuelto el ejercicio y la flag es: <code class="language-plaintext highlighter-rouge">Mommy, I thought libc random is unpredictable... (Mami, pensé que libc random era impredecible...)</code></p> <p>Eso ha sido todo, gracias por leer ❤</p> <p><img src="/assets/img/prng/waifu.webp" alt="" /></p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#Explotacion Binaria" title="Pages tagged Explotacion Binaria" class="tag"><span class="term">Explotacion Binaria</span></a><a href="http://localhost:4000/tags/#bad seed" title="Pages tagged bad seed" class="tag"><span class="term">bad seed</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/prng-bad-seeds/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/prng-bad-seeds/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/prng-bad-seeds/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <!----> <section id="utterances_thread" class="animated fadeInUp"> <script src="https://utteranc.es/client.js" repo="ic4rta/ic4rta.github.io" issue-term="pathname" label="Publicaciones" theme="github-light" crossorigin="anonymous" async> </script> </section> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'https-ic4rta-github-io'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
