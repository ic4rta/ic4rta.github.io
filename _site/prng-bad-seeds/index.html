<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Explotanto un PRNG bad seed &#8211; c4rta</title> <meta name="description" content="Te mostrare como puedes abusar de la generacion de numeros aleatorios generados por la funcion rand() con el fin de predecir un numero"> <meta name="keywords" content="Explotacion Binaria, bad seed"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="avatar.jpg"> <meta name="twitter:title" content="Explotanto un PRNG bad seed"> <meta name="twitter:description" content="Te mostrare como puedes abusar de la generacion de numeros aleatorios generados por la funcion rand() con el fin de predecir un numero"> <meta name="twitter:site" content="@_c4rta_"> <meta name="twitter:creator" content="@_c4rta_"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Explotanto un PRNG bad seed"> <meta property="og:description" content="Te mostrare como puedes abusar de la generacion de numeros aleatorios generados por la funcion rand() con el fin de predecir un numero"> <meta property="og:url" content="http://localhost:4000/prng-bad-seeds/"> <meta property="og:site_name" content="c4rta"> <meta property="og:image" content="http://localhost:4000/images/avatar.jpg"> <link rel="canonical" href="http://localhost:4000/prng-bad-seeds/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/assets/img/fondo6.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/assets/img/fondo2.gif) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/assets/img/fondo3.jpg) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/avatar.jpg"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Explotanto un PRNG bad seed </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags#Explotacion Binaria">Explotacion Binaria</a></li> <li><a href="http://localhost:4000/tags#bad seed">bad seed</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/prng-bad-seeds/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/prng-bad-seeds/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://localhost:4000/prng-bad-seeds/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">20 Dec 2022</div> <p class="lead">Te mostrare como puedes abusar de la generacion de numeros aleatorios generados por la funcion rand() con el fin de predecir un numero</p> <h2 id="que-es-una-seed">¿Que es una seed?</h2> <p>Las “seed” o semilla en español, es un numerito inicial del generador de numeros pseudoaleatorios (PRNG), la cual es completamente determinista, es decir, que la generacion de numeros aleatorios esta determinada por la semilla y eso hace que el generador produzca la misma secuencia de numeros para un valor dado.</p> <p>Esto va mas alla de hacer un simple programa en C que genere numeros random, las semillas se usan mucho en la ciberseguridad y mas que nada en la criptografia, es importante generar una buena semilla ya que si se obtiene el valor de la semilla se puede romper por completo el proceso de cifrado, parece una tonteria que con conocer un numerito se ocasiona un problema muy grave, si quieres ver ejemplos reales de una vulnerabilidad como esta puedes buscar</p> <ul> <li> <p>CVE-2020-7010: La aplicación en la nube en Kubernetes genera contraseñas mediante un generador de números aleatorios débil en función del tiempo de implementación.</p> </li> <li> <p>CVE-2019-11495: El servidor usa erlang:now() para sembrar el PRNG, lo que da como resultado un pequeño espacio de búsqueda para posibles semillas aleatorias</p> </li> <li> <p>CVE-2018-12520: El PRNG del producto no está sembrado para la generación de ID de sesión</p> </li> <li> <p>CVE-2016-10180: La generación de PIN del enrutador se basa en la siembra de rand (time(0)).</p> </li> </ul> <p>Referencia por <a href="https://cwe.mitre.org/data/definitions/335.html">MITRE</a></p> <h2 id="que-es-prng">¿Que es PRNG?</h2> <p>La generacion de numeros pseudoaleatorios (PRNG) es una funcion que genera numeros aleatorios dado tres estados, pongamolos que PRNG actua como una caja negra, que toma un numero (semilla) y produce una secuencia de bits, segun, se dice que esta secuencia es random si pasa una serie de pruebas estadisticas, y entonces se dice que es random, las pruebas puede ser que se mide la frecuencia de bits y secuencia de bits.</p> <p>Dije que esta dado tres estados, estos son:</p> <ul> <li><strong>Estado de inicializacion</strong>: El cual toma la semilla y pone al generador en su estado inicial</li> <li><strong>Estado de transicion</strong>: Transforma el estado del generador tomando en cuenta la semilla</li> <li><strong>Estado de salida</strong>: Transforma el estado actual para producir un numero fijo de bits</li> </ul> <p>Para que quede mas claro veamos lo siguiente:</p> <p>Se obtiene una secuencia de bits pseudoaleatoria el cual es puesta en el generador usando la semilla (primer estado), y poniendo al generador a llamar a la funcion de transicion repetidamente (segundo estado) y por ultimo se produce una salida de bits aleatorios (tercer estado)</p> <p><img src="/assets/img/prng/prng.png" alt="" /></p> <h2 id="explotando-un-prng-bad-seed">Explotando un PRNG bad seed</h2> <p>Usare el ejemplo mas simple que pude encontrar, es de la pagina pwnable.kr y el problema se llama “random”, te puedes contectar usando SSH <code class="highlighter-rouge">ssh random@pwnable.kr -p2222</code> pw:guest</p> <p>Este es el codigo del archivo ejecutable:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(){</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">random</span><span class="p">;</span>
	<span class="n">random</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span>	<span class="c1">// valor random
</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">key</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">scanf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">);</span>

	<span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">key</span> <span class="o">^</span> <span class="n">random</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xdeadbeef</span> <span class="p">){</span>
		<span class="n">printf</span><span class="p">(</span><span class="s">"Good!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
		<span class="n">system</span><span class="p">(</span><span class="s">"/bin/cat flag"</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">printf</span><span class="p">(</span><span class="s">"Wrong, maybe you should try 2^32 cases.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>Y como extra la pista que nos dejan es: <code class="highlighter-rouge">¡Papi, enséñame a usar valores aleatorios en la programación!</code></p> <p>El programa es muy simple acepta la entrada de números enteros y lo compara con 0xdeadbeef y, si el valor coincide, debe mostrar la flag</p> <p>El programa usa la función rand() para generar un valor aleatorio. La función rand() devuelve un número pseudoaleatorio, rand es inseguro para generar números aleatorios. Los números que genera son predecibles cuando la semilla no es dada para el rand. Entonces si la semilla se establece en 1, el generador se reinicializa a su valor inicial y produce los mismos valores</p> <h3 id="que-significa-key--random">¿Que significa “key ^ random”?</h3> <p>Esta es la pieza clave del programa, el símbolo ^ es el operador XOR en C. XOR es el equivalente a “o”, que significa “uno o el otro, pero no ambos”, con esto que tenemos hasta ahora se puede podemos generar una ecuacion que es <code class="highlighter-rouge">random ^ 0xdeadbeef = key</code>, esta ecuacion nos permite resolver <code class="highlighter-rouge">key</code></p> <h3 id="entonces-que-debemos-de-hacer">¿Entonces que debemos de hacer?</h3> <p>Para poder resolverlo debemos de hacer de que <code class="highlighter-rouge">key ^ random</code> sea igual a <code class="highlighter-rouge">0xdeadbeef</code> y para eso debemos de encontrar la manera de predecir el valor generado de la funcion rand() y luego revertir la operacion haciendo XORing el valor de rand() con 0xdeadbeef. Que genial, ¿No? ^-^</p> <h2 id="explotando-el-binario">Explotando el binario</h2> <p>Como primer paso generaremos un numero aleatorio con rand en otro programa</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">rand</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></div> <p>Una vez ejecutandolo nos dara este numero <code class="highlighter-rouge">1804289383</code> y nuestra ecuacion queda asi <code class="highlighter-rouge">1804289383 ^ 0xdeadbeef = key</code></p> <p>Como segundo paso vamos hacer XORing con <code class="highlighter-rouge">0xdeadbeef</code></p> <p>Yo lo hare abriendo el interprete de python e ingresare <code class="highlighter-rouge">1804289383 ^ 0xdeadbeef</code>, esto nos dara algo como esto <code class="highlighter-rouge">3039230856</code>, y ese valor es el numero que le pasaremos al programa</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>random@pwnable:~<span class="nv">$ </span>./random 
3039230856
Good!
Mommy, I thought libc random is unpredictable...
</code></pre></div></div> <p>Y listo, hemos resuelto el ejercicio y la flag es: <code class="highlighter-rouge">Mommy, I thought libc random is unpredictable... (Mami, pensé que libc random era impredecible...)</code></p> <p>Eso ha sido todo, gracias por leer ❤</p> <p><img src="/assets/img/prng/waifu.webp" alt="" /></p> <br> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/prng-bad-seeds/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/prng-bad-seeds/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://localhost:4000/prng-bad-seeds/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <nav class="pagination"> <a href="http://localhost:4000/leak-stack-canary/" class="pagination_pager" title="Leak stack canary - bypass ">previous</a> <a href="http://localhost:4000/htb-precious/" class="pagination_pager" title="HackTheBox Precious - Command injection y YAML deserialization ">next</a> </nav> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(https://www.drunkgaming.net/uploads/monthly_2023_07/ucmd1fimkara1.gif.dfdd0c0d3b5e1def01e9bc009ff1d853.gif) center center no-repeat;"> <a href="https://github.com/ic4rta/NazunaRansom" target="_blank" rel="nofollow external"> <span> Nazuna Ransomware </span> </a> </li> <li style="background:url(https://i.pinimg.com/originals/0c/af/9f/0caf9f7b8ab4917287aaaf8b8b772cd7.gif) center center no-repeat;"> <a href="https://github.com/ic4rta/Synergy-RAT" target="_blank" rel="nofollow external"> <span> Synergy RAT </span> </a> </li> <li style="background:url(https://media.tenor.com/XbbgjUJaLe0AAAAC/kumiko-oumae-nono.gif) center center no-repeat;"> <a href="https://github.com/ic4rta/PEjector" target="_blank" rel="nofollow external"> <span> PEjector </span> </a> </li> <li style="background:url(https://media.tenor.com/c7fsPiG8UwIAAAAC/bocchi-the-rock-anime.gif) center center no-repeat;"> <a href="https://github.com/ic4rta/ISCAN" target="_blank" rel="nofollow external"> <span> ISCAN </span> </a> </li> <li style="background:url(https://cdn.donmai.us/sample/fb/33/__zima_arknights_drawn_by_hi_yuuga__sample-fb330c3380344c3466f6972451d7c8c9.jpg) center center no-repeat;"> <a href="https://github.com/ic4rta/ZimaDropper" target="_blank" rel="nofollow external"> <span> Zima Dropper </span> </a> </li> </ul> </div> </body> </html>
