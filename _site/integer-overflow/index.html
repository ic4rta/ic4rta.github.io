<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>IOF - Integer Overflow/Underflow &#8211; c4rta</title> <meta name="description" content="Soy Omar, un amante de la ciberseguridad y las radiocomunicaciones"> <meta name="keywords" content="Explotacion Binaria, Integer Overflow"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo7.jpg"> <meta name="twitter:title" content="IOF - Integer Overflow/Underflow"> <meta name="twitter:description" content="En este post veremos como funciona y como realizar un Integer Overflow, almacenando un valor mayor del maximo soportado"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="IOF - Integer Overflow/Underflow"> <meta property="og:description" content="En este post veremos como funciona y como realizar un Integer Overflow, almacenando un valor mayor del maximo soportado"> <meta property="og:url" content="http://localhost:4000/integer-overflow/"> <meta property="og:site_name" content="c4rta"> <meta property="og:image" content="http://localhost:4000/assets/img/logo7.jpg"> <link rel="canonical" href="http://localhost:4000/integer-overflow/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="c4rta Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo7.jpg" alt="c4rta photo" class="author-photo"> <h4>c4rta</h4> <p>Soy Omar, un amante de la ciberseguridad y las radiocomunicaciones</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://github.com/ic4rta" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">All Posts</a></li> <li><a href="http://localhost:4000/tags/">All Tags</a></li> </ul> </li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>IOF - Integer Overflow/Underflow</h1> <h4>01 Aug 2022</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~4 minutes </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p class="lead">En este post veremos como funciona y como realizar un Integer Overflow, almacenando un valor mayor del maximo soportado</p> <h2 id="integer-overflow-y-underflow">Integer Overflow y underflow</h2> <p>Primeramente voy a explicar un poco acerca de los tipo de datos en C, pero mas que nada el maximo valor que pueden almacenar.</p> <p><img src="/assets/img/integer-overflow/integer.jpg" alt="" /></p> <p>Las variables que solo pueden almacenar valores positivos se llaman <code class="language-plaintext highlighter-rouge">unsigned integers</code>, y las que pueden almacenar valores positivos y negativos se llaman <code class="language-plaintext highlighter-rouge">signed integers</code>.</p> <p>Es importantes tomar en cuenta el maximo valor que puede almacenar un tipo de dato int ya que cuando se intenta almacenar números negativos, el bit más significativo se usa para indicar el signo (- o +), entonces si el bit más significativo se establece en 0, la variable se vuelve positiva y si el bit mas significativo se establece en 1 se vuelve negativa, para comprender esto mejor usare una calculadora que encontre.</p> <p><code class="language-plaintext highlighter-rouge">https://www.simonv.fr/TypesConvert/?integers</code></p> <p>Para este ejercicio voy a tomar de ejemplo una variable <code class="language-plaintext highlighter-rouge">signed int</code> de 32 bits que su valor maximo es <code class="language-plaintext highlighter-rouge">2147483647</code>, voy a ingresar ese valor para indicar lo que dije en el parrafo de arriba</p> <p><img src="/assets/img/integer-overflow/signed1.png" alt="" /></p> <p>Vemos como tenemos 32 bits (aparece el maximo 31 por que se empieza desde 0), de los cuales 31 estan prendidos, osea que su valor es <code class="language-plaintext highlighter-rouge">1</code>, y el bit mas significativo que es el 32 se establece en <code class="language-plaintext highlighter-rouge">0</code>, ya que ese es el que indica el signo, ahora ingresare <code class="language-plaintext highlighter-rouge">2147483647</code> + <code class="language-plaintext highlighter-rouge">1</code>, osea <code class="language-plaintext highlighter-rouge">2147483648</code></p> <p><img src="/assets/img/integer-overflow/signed2.png" alt="" /></p> <p>Podemos ver como 31 bits estan apagados, osea en 0, y el bit mas significativo esta en <code class="language-plaintext highlighter-rouge">1</code> osea que el signo ahora es negativo, y si vemos la descripcion que nos pone la pagina dice que la conversion ocasiono un overflow, o un integer overflow</p> <p>Entonces podemos decir que un Integer Overflow es cuando se intenta almacenar un valor mayor del maximo soportado ocasionado un Integer Overflow</p> <h3 id="integer-underflow">Integer Underflow</h3> <p>Es simplemente lo mismo solo que al reves, osea que un integer underflow se ocasiona cuando se intenta almacenar un valor menor al minimo valor admitido y el resultado se convierte en positivo</p> <h2 id="analizando-y-explotando-el-binario">Analizando y explotando el binario</h2> <p>Para este ejemplo tomare un binario de la sala pwn101 de TryHackMe <code class="language-plaintext highlighter-rouge">https://tryhackme.com/room/pwn101</code> el binario es del de pwn105.</p> <p>Si ejecutamos el binario nos muestra algo como esto</p> <p><img src="/assets/img/integer-overflow/binario.png" alt="" /></p> <p>Simplemente se estan recibiendo dos datos de tipo int y hace la suma</p> <p>Ahora metere el binario a radare2, me voy a la funcion main y pondre el comando <code class="language-plaintext highlighter-rouge">VVV</code> para obtener una vista por bloques</p> <p>Lo primero que vemos es la declaracion de variables donde hay una que se llama <code class="language-plaintext highlighter-rouge">var_ch</code> que se esta declarando como <code class="language-plaintext highlighter-rouge">signed int</code> como se ve en la imagen de abajo.</p> <p><img src="/assets/img/integer-overflow/radare1.png" alt="" /></p> <p>Ahora me movere a la parte donde el programa tome nuestro primer input</p> <p><img src="/assets/img/integer-overflow/radare2.png" alt="" /></p> <p>Vemos que el programa guarda nuestro primer input ingresado usando <code class="language-plaintext highlighter-rouge">0x0000216f</code>, y esto es un format string el cual es <code class="language-plaintext highlighter-rouge">%d</code> de igual manera arriba no los indica, de hecho esta en un comentario, entonces el binario toma nuestro input como un <code class="language-plaintext highlighter-rouge">signed int</code>, este input lo guarda en la variable <code class="language-plaintext highlighter-rouge">var_14</code>.</p> <p>Si bajamos un poco tenemos la otra parte donde se guarda nuestro segundo input que como se puede ver es exactamente lo mismo, simplemente ahora lo guarda en una variable que se llama <code class="language-plaintext highlighter-rouge">var_10</code>.</p> <p><img src="/assets/img/integer-overflow/radare3.png" alt="" /></p> <p>Ahora bajaremos a esta parte:</p> <p><img src="/assets/img/integer-overflow/radare4.png" alt="" /></p> <p>Lo primero que hace es mover el valor de <code class="language-plaintext highlighter-rouge">var_14</code> a <code class="language-plaintext highlighter-rouge">edx</code> y el valor de <code class="language-plaintext highlighter-rouge">var_10</code> a <code class="language-plaintext highlighter-rouge">eax</code> despues lo que hace es hacer una operacion de <code class="language-plaintext highlighter-rouge">add</code> osea una suma, y esta sumando el valor almacenado de nuestro primer input que esta en la variable <code class="language-plaintext highlighter-rouge">var_14h</code> y que se paso a <code class="language-plaintext highlighter-rouge">edx</code> con nuestro segundo input que esta en <code class="language-plaintext highlighter-rouge">var_10h</code> y que se paso de <code class="language-plaintext highlighter-rouge">eax</code> y el resultado lo almacena en <code class="language-plaintext highlighter-rouge">var_ch</code>.</p> <p>Despues tenemos el primer salto condicional que es <code class="language-plaintext highlighter-rouge">js 0x1384</code> en el cual checha si <code class="language-plaintext highlighter-rouge">var_14</code> tiene signo (+ o -), y en caso de que no lo tenga osea que es positivo salta a este bloque:</p> <p><img src="/assets/img/integer-overflow/radare5.png" alt="" /></p> <p>En el cual checa si nuestro segundo input que esta en <code class="language-plaintext highlighter-rouge">var_10</code> tiene signo (+ o -), si el resultado de esta operacion en false osea que no se cumplio la condicion y ambos valores son positivos, se salta a este bloque:</p> <p><img src="/assets/img/integer-overflow/radare6.png" alt="" /></p> <p>En el cual hace una comparacion entre el resultado de la suma de <code class="language-plaintext highlighter-rouge">var_10</code> y <code class="language-plaintext highlighter-rouge">var_14h</code> que esta almacenada en <code class="language-plaintext highlighter-rouge">var_10h</code> con 0, y si el resultado de la comparacion tiene signos negativos salta a este bloque:</p> <p><img src="/assets/img/integer-overflow/radare7.png" alt="" /></p> <p>En al cual basicamente esta ejecutando /bin/sh.</p> <h3 id="como-obtenemos-la-shell">¿Como obtenemos la shell?</h3> <p>Si tomamos en cuenta que <code class="language-plaintext highlighter-rouge">cmp</code> realiza la comparacion de esta forma:</p> <p><code class="language-plaintext highlighter-rouge">CMP destination, source</code></p> <p>Lo que tenemos que hacer es almacenar un valor en nuestro primer input que sea el valor maximo de <code class="language-plaintext highlighter-rouge">signed int</code> ya que <code class="language-plaintext highlighter-rouge">var_ch</code> se esta declarando como <code class="language-plaintext highlighter-rouge">signed int</code>, ademas de que el resultado de la suma de <code class="language-plaintext highlighter-rouge">var_10</code> y <code class="language-plaintext highlighter-rouge">var_14h</code> que se almacena en <code class="language-plaintext highlighter-rouge">var_ch</code> el primer numero que se le pasa es el que tiene almacenado <code class="language-plaintext highlighter-rouge">var_14</code> y nuestro segundo input le pondremos 1 para que el resultado sea negativo y ocasionemos un Integer Overflow</p> <p>Entonces la resolucion del ejercicio queda asi:</p> <p><img src="/assets/img/integer-overflow/radare9.png" alt="" /></p> <p><img src="/assets/img/integer-overflow/waifu.png" alt="" /></p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#Explotacion Binaria" title="Pages tagged Explotacion Binaria" class="tag"><span class="term">Explotacion Binaria</span></a><a href="http://localhost:4000/tags/#Integer Overflow" title="Pages tagged Integer Overflow" class="tag"><span class="term">Integer Overflow</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/integer-overflow/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/integer-overflow/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/integer-overflow/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <!----> <section id="utterances_thread" class="animated fadeInUp"> <script src="https://utteranc.es/client.js" repo="ic4rta/ic4rta.github.io" issue-term="pathname" label="Publicaciones" theme="github-light" crossorigin="anonymous" async> </script> </section> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'https-ic4rta-github-io'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
